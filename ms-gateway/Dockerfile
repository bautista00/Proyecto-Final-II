# Use a base image with Java and Alpine Linux
FROM adoptopenjdk/openjdk11:alpine

# Define environment variables
ENV SPRING_PROFILES_ACTIVE=production
ENV SPRING_APPLICATION_NAME=ms-gateway
ENV SERVER_PORT=8090
ENV EUREKA_INSTANCE_HOSTNAME=localhost
ENV EUREKA_INSTANCE_PREFER_IP_ADDRESS=true
ENV EUREKA_CLIENT_REGISTER_WITH_EUREKA=true
ENV EUREKA_CLIENT_FETCH_REGISTRY=true
ENV EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE=http://localhost:8761/eureka
ENV SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_KEYCLOAK-GATEWAY_ISSUER_URI=http://localhost:8080/realms/ticketrek
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK-GATEWAY_CLIENT-ID=api-gateway-client
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK-GATEWAY_CLIENT-SECRET=mbUrQfgEcBT6ALFMMg3sHqFSm3yezdMc
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK-GATEWAY_SCOPE=openid
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK-GATEWAY_AUTHORIZATION-GRANT-TYPE=authorization_code
ENV SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK-GATEWAY_REDIRECT-URI=http://localhost:8090/login/oauth2/code/keycloak

# Expose port 8090
EXPOSE 8090

# Copy the executable JAR file from the target directory into the image
COPY target/ms-gateway.jar /app/ms-gateway.jar

# Command to run the Spring Boot application when the container starts
CMD ["java", "-jar", "/app/ms-gateway.jar"]
